책임 행렬 $R$ 과  가용 행렬 $A$ 라는 두 개의 친밀도 행렬을 이용하여 군집화를 한다. 

군집 개수 $k$ 를 자동으로 알아내어 미리 설정할 필요가 없다. 

입력인 훈련집합 $X= \{x_1,x_2,...,x_n\}$ 에 대해서 이 때 두 샘플 $i$ 와 $k$ 간의 유사도 $s_{ik}$ 를 다음과 같이 정의한다. 

$s_{ik} = - ||x_i - x_k||_2^2$  

유클리디언 거리의 제곱에 음수를 취해서 거리가 작을수록 유사도 값은 커지게 된다. 

### 

### 책임 행렬 $R$

책임 행렬 $R$을 구성하는 $r_{ik}$ 를 구하는 식은 아래와 같다. 

$r_{ik}$ = $s_{ik} - max_{k' \ne k} (a_{ik'} + s_{ik'})$

= $- ||x_i - x_k||_2^2 - max_{k' \ne k} (a_{ik'} + s_{ik'})$

식을 해석하자면 

- 샘플 $i$ 와 $k$ 가 유사할 수록 큰 값을 부여하고,
- 샘플 $i$ 가 $k$ 외의 다른 샘플과 더 친밀할수록 더 큰 값을 빼어 값이 작아지게 한다.

### 

### 가용 행렬 $A$

 가용 행렬 $A$를 구성하는 $a_{ik}$를 구하는 식은 아래와 같다. 

$a_{ik} = min(0, r_{kk} + \sum_{i' \ne i,k} max(0,r_{i'k})), i\ne k$

식을 해석하자면 

- $r_{kk}$ 는 샘플 $k$ 가 자신에게 대표 자격을 부여하는 값으로 해석할 수 있고 이 값이 클 수록 $a_{ik}$ 가 크다.

- $r_{i'k}$ 가 클 수록 $a_{ik}$ 가 크다.

- 임계값을 0으로 두어 값이 0을 넘지 않도록 제어한다.

### 

### 친밀도 전파 알고리즘

유사도 $s$ 를 계산한 후 책임행렬 $R$ 과 가용 행렬 $A$ 를 이용하여 친밀도 $r$ 과 $a$ 를 계산하는 알고리즘이다.
